<html>
  <head>
    <title>Pollwiser</title>
    <script type='text/javascript' src='https://static.firebase.com/v0/firebase.js'></script>
    <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>
	<script src='vendor/d3.min.js'></script>
	<script src='vendor/d3.layout.min.js'></script>
	<script src='rickshaw.min.js'></script>
  </head>
  <body>
  	<div id='poll_data'>&nbsp;</div>
  	<div id="chart">&nbsp;</div>
	<script type='text/javascript'>
		var pollDataRef = new Firebase('https://demo.firebase.com/seifeet/rcp1');
		
		window.chartDataDem = [];
		window.chartDataGOP = [];
		var i = 0;
		pollDataRef.on('child_added', function(snapshot) {
			var data = snapshot.val();
			//$("#poll_data").html(data.Date + '&nbsp;' + $("#poll_data").html());

			window.chartDataDem.push({x:parseInt(data.Date), y:parseFloat(data.Obama)});
			window.chartDataGOP.push({x:parseInt(data.Date), y:parseFloat(data.Romney)});
			++i;
			if (i==100) {
				initChart();
			}
		});
		
		setInterval(function() { printChart() },3000);
				
		function initChart() {
			window.graph = new Rickshaw.Graph( {
		        element: document.querySelector("#chart"),
		        renderer: 'line',
		        width: 4000,
		        height: 250,
		        series: [ 
		        {
	                color: 'steelblue',
	                data: window.chartDataDem
		        },
		        {
		        		color: 'red',
		        		data: window.chartDataGOP	
		        } ]
			} );
		}

		function printChart() {
			//$("#chart").html('');
			window.chartDataDem.sort(function(a,b){return a.x - b.x});
			window.chartDataGOP.sort(function(a,b){return a.x - b.x});
			console.log(window.chartDataGOP);
			//var axes = new Rickshaw.Graph.Axis.Time( { graph: window.graph } );
			window.graph.render();
		}
	</script>
  </body>
</html>

